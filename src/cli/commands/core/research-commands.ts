import { SlashCommand } from '../../../types/command.js'
import { AgentContext } from '../../../types/agent.js'
import { extractOption } from './utils.js'

/**
 * è°ƒç ”ç±»å‘½ä»¤ï¼šresearch, deep-research
 * è´Ÿè´£ä¸»é¢˜ç ”ç©¶å’Œæ·±åº¦è°ƒç ”æŠ¥å‘Šç”Ÿæˆ
 */
export const researchCommands: SlashCommand[] = [
  {
    type: 'prompt',
    name: 'research', 
    description: 'æ·±åº¦ä¸»é¢˜ç ”ç©¶',
    aliases: ['ç ”ç©¶', 'è°ƒç ”', 'rs'],
    usage: '/research <ä¸»é¢˜> [é€‰é¡¹]',
    examples: [
      '/research AI Agentæ¶æ„è®¾è®¡',
      '/research åŒºå—é“¾æŠ€æœ¯å‘å±• --depth=æ·±å…¥ --sources=10',
      '/research é‡å­è®¡ç®—åº”ç”¨ --lang=ä¸­æ–‡ --time=æœ€è¿‘ä¸€å¹´'
    ],
    
    async getPromptForCommand(args: string, context: AgentContext): Promise<string> {
      const [topic, ...options] = args.split(' ')
      const depth = extractOption(options, 'depth') || 'æ ‡å‡†'
      const maxSources = extractOption(options, 'sources') || '8'
      const timeRange = extractOption(options, 'time') || 'æ— é™åˆ¶'
      const language = extractOption(options, 'lang') || 'ä¸­è‹±æ–‡'
      
      return `è¯·å¯¹ä¸»é¢˜"${topic}"è¿›è¡Œæ·±åº¦ç ”ç©¶ï¼Œæä¾›å…¨é¢çš„åˆ†ææŠ¥å‘Šï¼š

ç ”ç©¶å‚æ•°ï¼š
- ç ”ç©¶æ·±åº¦ï¼š${depth}
- æœ€å¤§æ¥æºï¼š${maxSources}ä¸ª
- æ—¶é—´èŒƒå›´ï¼š${timeRange}
- è¯­è¨€åå¥½ï¼š${language}

è¯·æä¾›ä»¥ä¸‹å†…å®¹ï¼š

## 1. ä¸»é¢˜æ¦‚è¿°
- åŸºæœ¬å®šä¹‰å’Œæ ¸å¿ƒæ¦‚å¿µ
- å‘å±•å†ç¨‹å’Œé‡è¦èŠ‚ç‚¹
- å½“å‰çš„é‡è¦æ€§å’Œå½±å“

## 2. ç°çŠ¶åˆ†æ  
- æŠ€æœ¯å‘å±•ç°çŠ¶
- ä¸»è¦å‚ä¸è€…å’Œå‚å•†
- å¸‚åœºè§„æ¨¡å’Œå¢é•¿è¶‹åŠ¿
- å­˜åœ¨çš„é—®é¢˜å’ŒæŒ‘æˆ˜

## 3. æœ€æ–°å‘å±•
- è¿‘æœŸé‡è¦çªç ´å’Œè¿›å±•
- æ–°æŠ€æœ¯å’Œæ–°æ–¹æ³•
- è¡Œä¸šåŠ¨æ€å’Œæ”¿ç­–å˜åŒ–

## 4. ä¸åŒè§‚ç‚¹å¯¹æ¯”
- æ”¯æŒè€…çš„ä¸»è¦è§‚ç‚¹
- è´¨ç–‘è€…çš„ä¸»è¦æ‹…å¿§
- å­¦æœ¯ç•Œçš„ç ”ç©¶æ–¹å‘
- äº§ä¸šç•Œçš„åº”ç”¨å®è·µ

## 5. æƒå¨èµ„æ–™æ¥æº
- å­¦æœ¯è®ºæ–‡å’Œç ”ç©¶æŠ¥å‘Š
- æƒå¨æœºæ„å‘å¸ƒçš„èµ„æ–™
- çŸ¥åä¸“å®¶çš„è§‚ç‚¹æ–‡ç« 
- å¯é çš„æ•°æ®ç»Ÿè®¡æ¥æº

## 6. å†™ä½œå»ºè®®
- é€‚åˆçš„æ–‡ç« è§’åº¦å’Œåˆ‡å…¥ç‚¹
- è¯»è€…å…³æ³¨çš„æ ¸å¿ƒé—®é¢˜
- å¯ä»¥æ·±å…¥è®¨è®ºçš„æŠ€æœ¯ç»†èŠ‚
- å®ç”¨çš„æ¡ˆä¾‹å’Œåº”ç”¨åœºæ™¯

è¯·ç¡®ä¿ä¿¡æ¯å‡†ç¡®ã€æ¥æºå¯é ï¼Œå¹¶æä¾›å…·ä½“çš„å¼•ç”¨é“¾æ¥ã€‚`
    },
    
    allowedTools: [
      'web_search', 'web_fetch', 'fact_checker', 
      'citation_manager', 'read_article', 'write_article'
    ],
    progressMessage: 'æ­£åœ¨è¿›è¡Œæ·±åº¦ä¸»é¢˜ç ”ç©¶',
    userFacingName: () => 'research'
  },

  {
    type: 'prompt',
    name: 'deep-research',
    description: 'æ™ºèƒ½æ·±åº¦è°ƒç ”æŠ¥å‘Šç”Ÿæˆ',
    aliases: ['è°ƒç ”', 'dr', 'ç ”ç©¶æŠ¥å‘Š', 'æ·±åº¦è°ƒç ”'],
    usage: '/deep-research <ç ”ç©¶ä¸»é¢˜> [é€‰é¡¹]',
    examples: [
      '/deep-research "äººå·¥æ™ºèƒ½åœ¨æ•™è‚²é¢†åŸŸçš„åº”ç”¨ç°çŠ¶"',
      '/deep-research "åŒºå—é“¾æŠ€æœ¯å‘å±•è¶‹åŠ¿" --depth=æ·±å…¥ --format=å­¦æœ¯',
      '/deep-research "é‡å­è®¡ç®—å•†ä¸šåŒ–å‰æ™¯" --sources=20 --format=å•†ä¸š'
    ],
    
    async getPromptForCommand(args: string, context: AgentContext): Promise<string> {
      const parts = args.split(' ')
      const topic = parts.find(part => !part.startsWith('--')) || parts[0]
      const options = parts.filter(part => part.startsWith('--'))
      
      const depth = extractOption(options, 'depth') || 'æ ‡å‡†'
      const format = extractOption(options, 'format') || 'ç»¼åˆ'
      const maxSources = extractOption(options, 'sources') || '15'
      const timeRange = extractOption(options, 'time') || 'æœ€è¿‘2å¹´'
      const language = extractOption(options, 'lang') || 'ä¸­è‹±æ–‡'
      
      if (!topic || !topic.trim()) {
        throw new Error('è¯·æä¾›ç ”ç©¶ä¸»é¢˜ã€‚ç”¨æ³•: /deep-research <ç ”ç©¶ä¸»é¢˜> [é€‰é¡¹]')
      }

      const formatMap: Record<string, string> = {
        'å­¦æœ¯': 'å­¦æœ¯ç ”ç©¶æ ¼å¼ï¼ŒåŒ…å«è¯¦ç»†çš„æ–¹æ³•è®ºå’Œå‚è€ƒæ–‡çŒ®',
        'å•†ä¸š': 'å•†ä¸šåˆ†ææ ¼å¼ï¼Œçªå‡ºå¸‚åœºä»·å€¼å’Œå•†ä¸šæœºä¼š',
        'æŠ€æœ¯': 'æŠ€æœ¯åˆ†ææ ¼å¼ï¼Œæ·±å…¥æŠ€æœ¯ç»†èŠ‚å’Œå®ç°æ–¹æ¡ˆ',
        'ç»¼åˆ': 'ç»¼åˆæ€§åˆ†æï¼Œå¹³è¡¡å­¦æœ¯æ·±åº¦å’Œå®ç”¨ä»·å€¼'
      }

      const depthMap: Record<string, string> = {
        'å¿«é€Ÿ': 'å¿«é€Ÿè°ƒç ”(15-30åˆ†é’Ÿ)ï¼Œæ”¶é›†åŸºç¡€ä¿¡æ¯å’Œæ ¸å¿ƒè§‚ç‚¹',
        'æ ‡å‡†': 'æ ‡å‡†è°ƒç ”(1-2å°æ—¶)ï¼Œå…¨é¢ä¿¡æ¯åˆ†æå’Œè¶‹åŠ¿åˆ¤æ–­',
        'æ·±å…¥': 'æ·±åº¦è°ƒç ”(2-4å°æ—¶)ï¼Œè¯¦å°½ç ”ç©¶å’Œæ·±å±‚æ¬¡åˆ†æ'
      }

      const formatDesc = formatMap[format] || 'ç»¼åˆæ€§åˆ†ææ ¼å¼'
      const depthDesc = depthMap[depth] || 'æ ‡å‡†æ·±åº¦è°ƒç ”'

      return `è¯·å¯¹ä¸»é¢˜"${topic}"è¿›è¡Œæ™ºèƒ½æ·±åº¦è°ƒç ”ï¼Œç”Ÿæˆä¸“ä¸šçº§è°ƒç ”æŠ¥å‘Šï¼š

## ğŸ“‹ è°ƒç ”å‚æ•°è®¾ç½®
- ç ”ç©¶ä¸»é¢˜: ${topic}
- è°ƒç ”æ·±åº¦: ${depthDesc}
- æŠ¥å‘Šæ ¼å¼: ${formatDesc}  
- ä¿¡æ¯æºæ•°é‡: ${maxSources}ä¸ª
- æ—¶é—´èŒƒå›´: ${timeRange}
- è¯­è¨€åå¥½: ${language}

## ğŸ” è°ƒç ”ä»»åŠ¡è¦æ±‚

### é˜¶æ®µ1: æ™ºèƒ½ä¿¡æ¯æ”¶é›†
1. **å¤šæºæ•°æ®é‡‡é›†**
   - æœç´¢å¼•æ“: æ”¶é›†æœ€æ–°ç½‘ç»œä¿¡æ¯å’Œæ–°é—»æŠ¥é“
   - å­¦æœ¯èµ„æº: æŸ¥æ‰¾ç›¸å…³ç ”ç©¶è®ºæ–‡å’Œå­¦æœ¯èµ„æ–™
   - å®˜æ–¹æ–‡æ¡£: æ”¶é›†æ”¿åºœæŠ¥å‘Šã€è¡Œä¸šç™½çš®ä¹¦
   - æƒå¨åª’ä½“: è·å–ä¸»æµåª’ä½“çš„æ·±åº¦åˆ†æ

2. **å…³é”®è¯æ™ºèƒ½æ‰©å±•**
   - åˆ†æä¸»é¢˜æ ¸å¿ƒæ¦‚å¿µï¼Œç”Ÿæˆç›¸å…³æœç´¢å…³é”®è¯
   - è¯†åˆ«åŒä¹‰è¯ã€ç›¸å…³æœ¯è¯­å’Œè¡Œä¸šä¸“ç”¨è¯æ±‡
   - ç¡®ä¿ä¿¡æ¯æ”¶é›†çš„å…¨é¢æ€§å’Œå‡†ç¡®æ€§

3. **ä¿¡æ¯æºæƒå¨æ€§è¯„ä¼°**
   - è¯„ä¼°å„ä¿¡æ¯æºçš„å¯ä¿¡åº¦å’Œæƒå¨æ€§
   - ä¼˜å…ˆé‡‡ç”¨é«˜è´¨é‡ã€æƒå¨çš„ä¿¡æ¯æº
   - æ ‡æ³¨ä¿¡æ¯æ¥æºå’Œå¯ä¿¡åº¦ç­‰çº§

### é˜¶æ®µ2: æ·±åº¦å†…å®¹åˆ†æ
1. **æ ¸å¿ƒè§‚ç‚¹æå–**
   - è¯†åˆ«å’Œæå–å„ä¿¡æ¯æºçš„æ ¸å¿ƒè§‚ç‚¹
   - åˆ†æä¸åŒç«‹åœºå’Œè§‚ç‚¹çš„å·®å¼‚
   - æ•´ç†ä¸»æµè§‚ç‚¹å’Œéä¸»æµè§‚ç‚¹

2. **æ•°æ®éªŒè¯ä¸äº¤å‰æ¯”å¯¹**
   - éªŒè¯å…³é”®æ•°æ®å’Œç»Ÿè®¡ä¿¡æ¯çš„å‡†ç¡®æ€§
   - è¿›è¡Œå¤šæºä¿¡æ¯äº¤å‰éªŒè¯
   - è¯†åˆ«å¹¶æ ‡æ³¨å­˜åœ¨äº‰è®®çš„ä¿¡æ¯

3. **è¶‹åŠ¿åˆ†æä¸é¢„æµ‹**
   - åˆ†æå†å²å‘å±•è½¨è¿¹å’Œå˜åŒ–è¶‹åŠ¿
   - è¯†åˆ«å½“å‰çš„å‘å±•æ€åŠ¿å’Œå½±å“å› ç´ 
   - åŸºäºæ•°æ®å’Œä¸“å®¶è§‚ç‚¹è¿›è¡Œè¶‹åŠ¿é¢„æµ‹

### é˜¶æ®µ3: ç»“æ„åŒ–æŠ¥å‘Šç”Ÿæˆ
è¯·æŒ‰ä»¥ä¸‹ç»“æ„ç”Ÿæˆä¸“ä¸šè°ƒç ”æŠ¥å‘Šï¼š

## ğŸ“Š [${topic}] æ·±åº¦è°ƒç ”æŠ¥å‘Š

### ğŸ“‹ æ‰§è¡Œæ‘˜è¦
- **æ ¸å¿ƒå‘ç°**: 3-5ä¸ªæœ€é‡è¦çš„å‘ç°å’Œæ´å¯Ÿ
- **å…³é”®æ•°æ®**: æœ€é‡è¦çš„ç»Ÿè®¡æ•°æ®å’Œå¸‚åœºæ•°æ®
- **ä¸»è¦ç»“è®º**: åŸºäºè°ƒç ”å¾—å‡ºçš„æ ¸å¿ƒç»“è®º
- **è¡ŒåŠ¨å»ºè®®**: é’ˆå¯¹ä¸åŒåˆ©ç›Šç›¸å…³è€…çš„å»ºè®®

### ğŸ¯ ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰
- **é—®é¢˜å®šä¹‰**: æ˜ç¡®ç ”ç©¶é—®é¢˜å’Œç ”ç©¶èŒƒå›´
- **ç ”ç©¶ä»·å€¼**: è¯´æ˜ç ”ç©¶çš„é‡è¦æ€§å’Œæ„ä¹‰
- **æ–¹æ³•è¯´æ˜**: ç®€è¦è¯´æ˜è°ƒç ”æ–¹æ³•å’Œä¿¡æ¯æ¥æº

### ğŸ“ˆ ç°çŠ¶å…¨é¢åˆ†æ
#### 3.1 å‘å±•å†ç¨‹å›é¡¾
- é‡è¦å‘å±•èŠ‚ç‚¹å’Œé‡Œç¨‹ç¢‘äº‹ä»¶
- å…³é”®æŠ€æœ¯çªç ´æˆ–æ”¿ç­–å˜åŒ–
- å¸‚åœºæ¼”è¿›å’Œç«äº‰æ ¼å±€å˜åŒ–

#### 3.2 å½“å‰å‘å±•çŠ¶å†µ
- æŠ€æœ¯æˆç†Ÿåº¦å’Œåº”ç”¨ç°çŠ¶
- å¸‚åœºè§„æ¨¡å’Œå¢é•¿è¶‹åŠ¿
- ä¸»è¦å‚ä¸è€…å’Œç«äº‰æ€åŠ¿
- å­˜åœ¨çš„é—®é¢˜å’ŒæŒ‘æˆ˜

#### 3.3 å…³é”®å½±å“å› ç´ 
- æŠ€æœ¯é©±åŠ¨å› ç´ 
- æ”¿ç­–å’Œç›‘ç®¡ç¯å¢ƒ
- å¸‚åœºéœ€æ±‚å’Œç”¨æˆ·è¡Œä¸º
- ç»æµå’Œç¤¾ä¼šç¯å¢ƒå½±å“

### ğŸ” æ·±åº¦åˆ†æä¸æ´å¯Ÿ
#### 4.1 æŠ€æœ¯å‘å±•åˆ†æ
- æ ¸å¿ƒæŠ€æœ¯åŸç†å’Œç‰¹ç‚¹
- æŠ€æœ¯ä¼˜åŠ¿å’Œå±€é™æ€§
- ä¸å…¶ä»–æŠ€æœ¯çš„å¯¹æ¯”åˆ†æ
- æŠ€æœ¯å‘å±•è·¯çº¿å›¾

#### 4.2 å¸‚åœºæœºä¼šä¸æŒ‘æˆ˜
- å¸‚åœºæœºä¼šå’Œå¢é•¿æ½œåŠ›
- é¢ä¸´çš„ä¸»è¦æŒ‘æˆ˜å’Œé£é™©
- ç«äº‰ä¼˜åŠ¿å’Œå·®å¼‚åŒ–è¦ç´ 
- å•†ä¸šæ¨¡å¼å’Œç›ˆåˆ©æ¨¡å¼

#### 4.3 å…¸å‹åº”ç”¨æ¡ˆä¾‹
- æˆåŠŸæ¡ˆä¾‹åˆ†æå’Œç»éªŒæ€»ç»“
- å¤±è´¥æ¡ˆä¾‹åæ€å’Œæ•™è®­
- æœ€ä½³å®è·µå’Œå®æ–½å»ºè®®

### ğŸš€ æœªæ¥å‘å±•é¢„æµ‹
#### 5.1 çŸ­æœŸå±•æœ› (1-2å¹´)
- é¢„æœŸçš„æŠ€æœ¯çªç ´å’Œäº§å“å‘å¸ƒ
- å¸‚åœºå˜åŒ–å’Œç«äº‰æ€åŠ¿
- æ”¿ç­–ç¯å¢ƒå¯èƒ½çš„å˜åŒ–

#### 5.2 ä¸­æœŸè¶‹åŠ¿ (3-5å¹´)
- æŠ€æœ¯æˆç†Ÿåº¦å’Œåº”ç”¨æ™®åŠ
- å¸‚åœºè§„æ¨¡å’Œç»“æ„å˜åŒ–
- äº§ä¸šé“¾æ•´åˆå’Œç”Ÿæ€å‘å±•

#### 5.3 é•¿æœŸæ„¿æ™¯ (5-10å¹´)
- æŠ€æœ¯å‘å±•çš„ç»ˆæç›®æ ‡
- å¯¹ç¤¾ä¼šå’Œç»æµçš„æ·±è¿œå½±å“
- å¯èƒ½çš„é¢ è¦†æ€§å˜åŒ–

### ğŸ’¡ ç»“è®ºä¸å»ºè®®
#### 6.1 æ ¸å¿ƒç»“è®º
- åŸºäºè°ƒç ”çš„ä¸»è¦ç»“è®º
- å¯¹åˆå§‹ç ”ç©¶é—®é¢˜çš„å›ç­”
- é‡è¦å‘ç°çš„æ€»ç»“

#### 6.2 å·®å¼‚åŒ–è§‚ç‚¹
- ä¸ä¸»æµè§‚ç‚¹ä¸åŒçš„è§è§£
- åŸºäºæ•°æ®çš„ç‹¬ç‰¹åˆ†æ
- å…·æœ‰å‰ç»æ€§çš„åˆ¤æ–­

#### 6.3 è¡ŒåŠ¨å»ºè®®
- é’ˆå¯¹æŠ•èµ„è€…çš„å»ºè®®
- é’ˆå¯¹ä»ä¸šè€…çš„å»ºè®®  
- é’ˆå¯¹æ”¿ç­–åˆ¶å®šè€…çš„å»ºè®®
- é’ˆå¯¹ç ”ç©¶äººå‘˜çš„å»ºè®®

### ğŸ“š ä¿¡æ¯æ¥æºä¸å‚è€ƒèµ„æ–™
- æŒ‰æƒå¨æ€§å’Œç›¸å…³æ€§åˆ†ç±»æ•´ç†æ‰€æœ‰ä¿¡æ¯æº
- æä¾›å…·ä½“çš„å¼•ç”¨é“¾æ¥å’Œè®¿é—®æ—¶é—´
- æ ‡æ³¨ä¿¡æ¯çš„å¯ä¿¡åº¦å’Œä½¿ç”¨å»ºè®®

### ğŸ“Š å…³é”®æ•°æ®ä¸å›¾è¡¨å»ºè®®
- æ•´ç†è°ƒç ”è¿‡ç¨‹ä¸­çš„é‡è¦æ•°æ®
- å»ºè®®åˆ¶ä½œçš„å›¾è¡¨å’Œå¯è§†åŒ–å†…å®¹
- æ•°æ®çš„è§£è¯»å’Œåˆ†æè¦ç‚¹

## âš¡ ç‰¹åˆ«è¦æ±‚

1. **ä¿¡æ¯å‡†ç¡®æ€§**: æ‰€æœ‰æ•°æ®å’Œè§‚ç‚¹å¿…é¡»æœ‰å¯é æ¥æºæ”¯æ’‘
2. **é€»è¾‘æ¸…æ™°**: æŠ¥å‘Šç»“æ„æ¸…æ™°ï¼Œè®ºè¿°é€»è¾‘ä¸¥å¯†
3. **è§è§£ç‹¬åˆ°**: ä¸åªæ˜¯ä¿¡æ¯æ±‡æ€»ï¼Œè¦æœ‰æ·±åº¦åˆ†æå’Œç‹¬ç‰¹è§è§£
4. **å®ç”¨ä»·å€¼**: ä¸ºä¸åŒè¯»è€…ç¾¤ä½“æä¾›å¯æ“ä½œçš„å»ºè®®
5. **å¼•ç”¨è§„èŒƒ**: æ‰€æœ‰å¼•ç”¨ä¿¡æ¯éƒ½è¦æ³¨æ˜å‡ºå¤„å’Œæ—¶é—´

è¯·å¼€å§‹æ‰§è¡Œè¿™ä¸ª${depthDesc}ï¼Œç¡®ä¿ç”Ÿæˆé«˜è´¨é‡çš„ä¸“ä¸šè°ƒç ”æŠ¥å‘Šã€‚`
    },
    
    allowedTools: [
      'web_search', 'web_fetch', 'fact_checker', 'citation_manager',
      'read_article', 'write_article', 'research_analyzer', 'trend_detector'
    ],
    progressMessage: 'æ­£åœ¨è¿›è¡Œæ™ºèƒ½æ·±åº¦è°ƒç ”ï¼Œè¯·ç¨å€™...',
    userFacingName: () => 'deep-research'
  }
]